[tox]
envlist = lint, coverage, planetary_feedback, trait_evolution, onboarding_scrolls, bandit, mypy, black, isort, safety

setenv =
    PYTHONPATH = {toxinidir}
deps =
    pytest
    pygame

[testenv:lint]
description = Run Ruff (fast lint/format) and Pylint (deep semantic checks)
skip_install = true
setenv =
    PYTHONPATH = {toxinidir}
deps =
    ruff==0.6.9
    pylint==3.2.6
    platformdirs<4
    pygame
    requests
    pytest
commands =
    # Ruff first: lint + auto-fix
    ruff check . --fix
    ruff format .

    # Pylint second: deep semantic analysis, using tox.ini config
    pylint --rcfile=tox.ini src/devscape

[testenv:coverage]
allowlist_externals = pytest
commands =
    pytest --maxfail=1 --disable-warnings --cov=src --cov-report=term-missing --cov-fail-under=40

[testenv:planetary_feedback]
deps =
    pytest
    # Add any specific dependencies for planetary feedback tests here
commands =
    pytest tests/planetary_feedback/ # Placeholder: Adjust path and command as needed

[testenv:trait_evolution]
deps =
    pytest
    # Add any specific dependencies for trait evolution tests here
commands =
    pytest tests/trait_evolution/ # Placeholder: Adjust path and command as needed

[testenv:onboarding_scrolls]
deps =
    pytest
    # Add any specific dependencies for onboarding scrolls tests here
commands =
    pytest tests/onboarding_scrolls/ # Placeholder: Adjust path and command as needed

[testenv:bandit]
deps = bandit
commands = bandit -r src/devscape --configfile .bandit

[testenv:mypy]
deps = mypy
commands = mypy src/devscape

[testenv:black]
deps = black
commands = black .

[testenv:isort]
deps = isort
commands = isort .

[testenv:safety]
deps = safety
commands = python -m safety check

[tool.pylint.'MESSAGES CONTROL']
# Global settings (apply everywhere unless overridden)
disable =
    C0114,  # missing-module-docstring
    C0115,  # missing-class-docstring
    C0116,  # missing-function-docstring

[tool.pylint.'MASTER']
# Ensure tests/ is recognized as a separate package


[tool.pylint.'MESSAGES CONTROL:tests']
# This section applies only to files under tests/
disable =
    W0621,  # redefined-outer-name (common with pytest fixtures)
